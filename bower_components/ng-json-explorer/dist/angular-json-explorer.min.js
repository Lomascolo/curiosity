angular.module("ngJsonExplorer",[]).directive("jsonExplorer",["$http",function(n){"use strict";return{restrict:"E",scope:{jsonData:"@",collapsed:"@"},link:function(n,a,l){function e(l){var e=null;if(angular.isObject(l))e=l;else try{e=JSON.parse(l)}catch(r){return void(e={error:"invalid json"})}o(e)&&n.sortBy&&(e=e.sort(function(a,l){var e=n.sortBy.split(":"),r=e[0],s=e[1],i=a[r],t=l[r],o=function(n,a){return n-a},u=function(n,a){return n.length-a.length},p=null;if("number"==typeof i&&"number"==typeof t)p=o;else{if(!i.hasOwnProperty("length")||!t.hasOwnProperty("length"))return;p=u}return"asc"==s?p(i,t):"desc"==s?p(t,i):p(i,t)})),o(e)?f='[<ul class="array">':u(e)&&(f='{<ul class="object">');for(var s in e){var i=s,g=e[s];t(g)?f+="<li>"+p(i,g)+",</li>":o(g)?f+="<li>"+c(i,g)+",</li>":u(g)&&(f+="<li>"+d(i,g)+",</li>")}f=f.replace(/,<\/li>$/gim,"</li>"),o(e)?f+="</ul>]":u(e)&&(f+="</ul>}"),a.html('<div class="angular-json-explorer">'+f+"</div>");for(var h=a[0].getElementsByTagName("a"),v=0;v<h.length;v++){var m=h[v];angular.element(m).on("click",function(n){n.preventDefault();var a=angular.element(this).parent().next(),l=angular.element(this).parent().next().next();"+"==this.innerHTML?(a.addClass("hidden"),l.removeClass("hidden"),this.innerHTML="-"):(a.removeClass("hidden"),l.addClass("hidden"),this.innerHTML="+")})}}angular.isBoolean||(angular.isBoolean=function(n){return typeof n==Boolean});var r="+",s="",i="hidden";n.collapsed&&(r="-",s="hidden",i="");var t=function(n){return angular.isString(n)||angular.isNumber(n)||angular.isBoolean(n)||null===n},o=function(n){return angular.isArray(n)},u=function(n){return angular.isObject(n)},p=function(n,a){var l="";return n&&(l='<span class="prop>">'+n+"</span>: "),"string"==typeof a?l+'<span class="string">"'+a+'"</span>':"number"==typeof a?l+'<span class="num">'+a+"</span>":"boolean"==typeof a?l+'<span class="bool">'+a+"</span>":l+'<span class="null">'+a+"</span>"},c=function(n,a){var l='<span class="prop>"><a href="#" class="collapser">'+r+"</a></span> [";n&&(l='<span class="prop>"><a href="#" class="collapser">'+r+"</a>"+n+"</span>: ["),l+='<span class="ellipsis '+s+'">...</span>',l+='<ul class="array collapsible '+i+'">';for(var e=0;e<a.length;e++)t(a[e])?l+="<li>"+p(null,a[e])+",</li>":o(a[e])?l+="<li>"+c(null,a[e])+",</li>":u(a[e])&&(l+="<li>"+d(null,a[e])+",</li>");return l=l.replace(/,<\/li>$/gim,"</li>"),l+="</ul>",l+="]"},d=function(n,a){var l='<span class="prop>"><a href="#" class="collapser">'+r+"</a></span> {";n&&(l='<span class="prop>"><a href="#" class="collapser">'+r+"</a>"+n+"</span>: {"),l+='<span class="ellipsis '+s+'">...</span>',l+='<ul class="object collapsible '+i+'">';for(var e in a)t(a[e])?l+="<li>"+p(e,a[e])+",</li>":o(a[e])?l+="<li>"+c(e,a[e])+",</li>":u(a[e])&&(l+="<li>"+d(e,a[e])+",</li>");return l=l.replace(/,<\/li>$/gim,"</li>"),l+="</ul>",l+="}"},f="";l.$observe("jsonData",function(n){n&&e(n)}),l.$observe("collapsed",function(n){if(void 0!=n)for(var l=a[0].getElementsByTagName("a"),e=0;e<l.length;e++){var r=l[e],s=angular.element(r).parent().next(),i=angular.element(r).parent().next().next();1==n?"-"==r.innerHTML&&(s.removeClass("hidden"),i.addClass("hidden"),r.innerHTML="+"):"+"==r.innerHTML&&(s.addClass("hidden"),i.removeClass("hidden"),r.innerHTML="-")}})}}}]);